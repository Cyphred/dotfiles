# !/bin/sh

# Prints number of all tasks, and overdue ones.
# Total number of tasks has emoji ğŸ“‹
# Number of overdue tasks has emoji âŒ›

output() {
	output="ğŸ“‹$1"
	# Due today
	[ ! -z "$2" ] && [ "$2" -gt 0 ] && output+=" âŒ›$2"

	# Overdue
	[ ! -z "$3" ] && [ "$3" -gt 0 ] && output+=" ğŸ”´$3"

	printf "$output\n"
	exit
}

tasks=$(task list | awk 'END {print $(NF-1)}')
[ "$tasks" -gt 0 ] || output 0

overdueOutput=$(task overdue)
dueToday=$(printf "$overdueOutput" | grep $(date +%Y-%m-%d) | wc -l)
overdue=$(printf "$overdueOutput" | awk 'END {print $(NF-1)}')
[ "$dueToday" -gt 0 ] && let overdue=$overdue-$dueToday

output $tasks $dueToday $overdue

case $BLOCK_BUTTON in
	3) notify-send "ğŸ“‹ Task module" "ğŸ“‹ $tasks tasks
âŒ› $dueToday tasks due today
ğŸ”´ $overdue tasks overdue" ;;
esac
